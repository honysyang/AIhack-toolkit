# Ollama 服务检测脚本文档

## 概述
本脚本旨在检测指定 IP 地址或网段内的 Ollama 服务是否存在配置不当的未授权访问漏洞（CNVD-2025-04094）。

## 漏洞概述
Ollama 服务默认未设置身份验证和访问控制机制。当用户将服务（默认端口为 11434）暴露在公网时，未经身份验证的攻击者可以直接调用其 API 接口，实施包括窃取敏感模型资产、投喂虚假信息、篡改系统配置或滥用模型推理资源等恶意行为。目前该漏洞细节已公开，且已发现有在野利用的情况，请相关用户尽快采取防护措施。

## 脚本运行环境要求
### Python 版本
- Python 3.x

### 依赖库
- `requests`：用于发送 HTTP 请求。
- `tqdm`：用于显示扫描进度条。

你可以使用以下命令安装所需的 Python 库：
```bash
pip install requests tqdm
```

## 使用方法

### 基本用法
运行脚本时，需要通过 `--ip` 参数指定要检测的 IP 地址或网段。使用 `-v` 选项可以打印详细的扫描日志。

#### 打印扫描日志
```bash
python check_ollama_service.py --ip 192.168.1.0/24 -v
```

#### 不打印扫描日志
```bash
python check_ollama_service.py --ip 192.168.1.0/24
```

### 参数说明
| 参数 | 说明 | 是否必需 | 示例 |
| ---- | ---- | ---- | ---- |
| `--ip` | 指定要检测的 Ollama 服务的 IP 地址或网段 | 是 | `192.168.1.1` 或 `192.168.1.0/24` |
| `-v` | 可选参数，添加该参数会打印详细的扫描日志 | 否 | 无 |

## 输出示例

### 发现服务并存在漏洞
```plaintext
python .\check_ollama_service.py --ip 10.1.2.40/24   

██████╗ ██╗   ██╗███████╗███████╗██████╗ 
██╔══██╗██║   ██║██╔════╝██╔════╝██╔══██╗
██████╔╝██║   ██║███████╗█████╗  ██████╔╝
██╔══██╗██║   ██║╚════██║██╔══╝  ██╔══██╗
██████╔╝╚██████╔╝███████║███████╗██║  ██║
╚═════╝  ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝
Ollama 服务检测脚本

扫描进度: 100%|█████████████████████████████| 254/254 [01:44<00:00,  2.42it/s]
IP 10.1.2.40 的 Ollama 服务正在运行
警告：IP 10.1.2.40 的 Ollama 服务存在未授权漏洞
具体特征为：攻击者可未授权访问 Ollama 服务的 API，实现删除模型等操作
```

### 未发现服务
```plaintext
python .\check_ollama_service.py --ip 10.1.2.41
██████╗ ██╗   ██╗███████╗███████╗██████╗ 
██╔══██╗██║   ██║██╔════╝██╔════╝██╔══██╗
██████╔╝██║   ██║███████╗█████╗  ██████╔╝
██╔══██╗██║   ██║╚════██║██╔══╝  ██╔══██╗
██████╔╝╚██████╔╝███████║███████╗██║  ██║
╚═════╝  ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝
Ollama 服务检测脚本

扫描进度: 100%|████████████████████████████████████████████████████████████████████| 1/1 [00:04<00:00,  4.89s/it]
未发现任何 Ollama 服务
```
